# C++/Qt 文件与消息传输系统

## 1. 项目简介

这是一个基于C++开发的客户端-服务器（C/S）架构应用，旨在实现实时的文本消息和文件传输功能。

-   **服务器端**：采用C++编写，运行于Linux环境。使用`epoll` I/O多路复用技术处理高并发连接，通过MySQL数据库管理客户端信息，并将接收到的消息和文件广播给所有在线客户端。
-   **客户端**：采用C++和Qt框架开发，提供图形用户界面（GUI），用户可以通过界面连接服务器、发送消息和传输文件。

## 2. 主要功能

### 通用
-   **自定义网络协议**：定义了统一的二进制协议头（`PacketHeader`），支持文本、文件（开始、分片、结束）、ACK确认等多种消息类型，确保客户端与服务器之间高效、可靠的通信。

### 服务器端 (`server_enhanced.cpp`)
-   **高并发处理**：使用`epoll`的边缘触发（ET）模式，高效管理大量客户端连接。
-   **客户端管理**：
    -   连接时自动将客户端信息（IP, Port）存入MySQL数据库，并分配唯一ID。
    -   实时维护并广播在线客户端列表。
-   **消息与文件转发**：作为中继，将从一个客户端收到的所有消息（文本或文件）广播给所有其他在线客户端。
-   **分片传输**：支持大文件分片传输，服务器负责转发文件块。
-   **健壮性**：
    -   通过心跳（最后活动时间）和超时机制，清理无响应的客户端和文件传输任务。
    -   提供命令行`exit`指令，实现服务器的优雅退出。

### 客户端 (`widget.cpp`, `widget.h`)
-   **图形用户界面**：基于Qt构建，界面友好，操作直观。
-   **连接管理**：用户可输入服务器IP和端口号进行连接。
-   **文本消息**：支持发送和接收文本消息，并在界面上区分发送方和接收方。
-   **文件传输**：
    -   支持选择本地文件并发送。
    -   发送方实现文件分片和基于ACK的重传机制，保证传输可靠性。
    -   接收方以通知卡片的形式展示待接收的文件（最多同时显示3个）。
    -   提供**接收**、**另存为**、**拒绝**三种操作选项。
    -   实时显示文件接收进度条。
    -   在用户接受文件前，将收到的文件块缓存，避免不必要的文件写入。
